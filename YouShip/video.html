<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>YouShip — Player</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <!--
      video.html
      - Recebe query param `id` (por exemplo ?id=v1)
      - Busca `js/cards.json` e tenta encontrar o objeto com o mesmo id
      - Se o objeto tiver `file` (ex: videos/v1.mp4) será usado como fonte do player
      - Se não houver arquivo local, mostramos a thumbnail e informações
      - Ao iniciar o play, o vídeo é registrado no histórico (localStorage)
    -->
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-youship px-3">
      <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
            <rect width="24" height="24" rx="4" fill="var(--youship-orange)"/>
            <path d="M9 8l6 4-6 4V8z" fill="#fff"/>
          </svg>
          <span class="brand">YouShip</span>
        </a>
      </div>
    </nav>

    <div class="container py-4">
      <div id="videoWrap">
        <div class="text-muted">Carregando vídeo...</div>
      </div>
    </div>

    <script>
      // Função utilitária para ler query params
      function getQueryParam(name){
        const params = new URLSearchParams(location.search);
        return params.get(name);
      }

      // carregar dados e renderizar player
      (async function(){
        const id = getQueryParam('id');
        const wrap = document.getElementById('videoWrap');
        if(!id){ wrap.innerHTML = '<div class="alert alert-warning">ID de vídeo não informado.</div>'; return; }

        try{
          const res = await fetch('js/cards.json');
          const list = await res.json();
          const video = list.find(v=> v.id === id || encodeURIComponent(v.id) === id || encodeURIComponent(v.title) === id);
          if(!video){
            wrap.innerHTML = '<div class="alert alert-danger">Vídeo não encontrado.</div>';
            return;
          }

          // construir player
          let html = '';
          if(video.file){
            // usar player HTML5
            html += `<video id="youPlayer" class="w-100 rounded" controls crossorigin playsinline>
                      <source src="${video.file}" type="video/mp4">
                      Seu navegador não suporta HTML5 video.
                    </video>`;
          }else{
            // sem arquivo local: mostrar thumbnail como placeholder
            html += `<div class="ratio ratio-16x9" style="background:#000 url(${video.thumb}) center/cover no-repeat"></div>`;
          }

          html += `<div class="mt-3">
                    <h4>${video.title}</h4>
                    <div class="text-muted">${video.channel} • ${video.viewsText || video.views || ''}</div>
                    <p class="mt-2">Descrição dinâmica pode ser adicionada aqui.</p>
                   </div>`;

          wrap.innerHTML = html;

          // registrar no histórico ao começar a reproduzir (se houver player)
          const player = document.getElementById('youPlayer');
          if(player){
            player.addEventListener('play', ()=>{
              try{
                const key = 'youshipHistory';
                const raw = localStorage.getItem(key);
                const arr = raw ? JSON.parse(raw) : [];
                arr.unshift(Object.assign({}, video, {viewedAt: Date.now()}));
                localStorage.setItem(key, JSON.stringify(arr.slice(0,200)));
              }catch(e){ console.error(e); }
            });
          }

        }catch(e){
          wrap.innerHTML = '<div class="alert alert-danger">Erro carregando dados.</div>';
          console.error(e);
        }
      })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
